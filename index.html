<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ABRC DEVICE TESTING</title>
  <style>
    .p {
      font-size: 20px;
      font-family: sans-serif;
      text-align: center;
    }
    body {
      font-family: Helvetica, sans-serif;
      margin: 0;
      padding: 0;
    }
    .header {
      background-color: lightblue;
      padding: 10px;
      text-align: center;
    }
    #mainDiv {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      background-color: grey;
      padding: 10px;
      flex-direction: row;
    }
    .box {
      max-width: 400px;
      width: 100%;
      height: 80%;
      background-color: lightcoral;
      border: 3px solid black;
      margin: 2px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      min-height: 100px;
      align-items: center;
      justify-content: center;
    }
    button {
      background-color: #4CAF50;
      border: 3px solid darkgreen;
      color: white;
      padding: 5px 2px;
      text-align: center;
      margin: 5px;
      height: 50px;
      width: 100px;
    }
    #visualizer {
      width: 300px;
      height: 120px;
      background-color: green;
      border-radius: 4px;
      position: relative;
    }
    #visualizer canvas {
      width: 100%;
      height: 100%;
      border-radius: 4px;
    }
    .camera-box {
      text-align: center;
    }
    .camera-box img {
      max-width: 100%;
      max-height: 500px;
    }
    .description {
      font-size: 14px;
      font-family: Arial, sans-serif;
      margin-top: 5px;
    }
    .keyboard-key {
      width: 30px;
      height: 30px;
      margin: 2px;
      display: inline-block;
      text-align: center;
      line-height: 30px;
      border: 1px solid black;
      background-color: white;
    }
    
    .key-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }
    .key-row {
      display: flex;
    }
  </style>
</head>
<body>
  <div class="header">
    <p>ABRC DEVICE TESTING</p>
  </div>
  
  <div id="mainDiv">
    <div class="box">
      <div>
        <p>Audio/Mic Test</p>
      </div>
      <div>
        <button class="left">&#9664;</button>
        <button class="play">Button</button>
        <button class="right">&#9654;</button>
      </div>
      <div>
        <button class="left">&#9664;</button>
        <button class="play">Button</button>
        <button class="right">&#9654;</button>
      </div>
      <div>
        <button class="left">&#9664;</button>
        <button class="play">Button</button>
        <button class="right">&#9654;</button>
      </div>
      <div id="visualizer"></div>
      <div>
        <button id="pauseAll">Pause Audio</button>
      </div>
    </div>
    <div class="box camera-box" style="height: 412px;">
      <div>
        <p>Camera Test</p>
      </div>
      <div></div>
      <div style="width:300px; height:400px; border:3px solid black ; margin-bottom: 20px;">
        <img id="front-image" src="" alt="Front Camera Image Loading" />
        <div id="front-description" class="description"></div>
      </div>
      <div style="width:200px; height:100px;  border:3px solid black ;">
        <img id="back-image" src="" alt="Back Camera Image Loading" />
        <div id="back-description" class="description"></div>
      </div>  
      <button id="recapture-button">Recapture</button>
    
    </div>
    <div class="box" style="max-width: 600px;">
      <div>
        <p>Keyboard Key Tester</p>
      </div>
      <div class="key-container" id="keyContainer">
        <!-- Keys will be dynamically added here -->
      </div>
    </div>
    <div class="box" style="max-width:200px; height: 268px;"> <p> hi</p></div>
 
  
  </div>

  <script>
    // Get the visualizer element
    const visualizer = document.getElementById('visualizer');
    const canvas = document.createElement('canvas');
    canvas.width = visualizer.clientWidth;
    canvas.height = visualizer.clientHeight;
    visualizer.appendChild(canvas);
    const canvasCtx = canvas.getContext('2d');

    // Set up audio context
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    let audioContext;

    // Function to start the audio context
    function startAudioContext() {
      if (!audioContext) {
        audioContext = new AudioContext();

        // Access the microphone
        navigator.mediaDevices.getUserMedia({ audio: true })
          .then(function(stream) {
            const source = audioContext.createMediaStreamSource(stream);
            const analyser = audioContext.createAnalyser();
            source.connect(analyser);

            analyser.fftSize = 256;
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);

            canvasCtx.clearRect(0, 0, canvas.width, canvas.height);

            function draw() {
              const WIDTH = canvas.width;
              const HEIGHT = canvas.height;

              requestAnimationFrame(draw);

              analyser.getByteFrequencyData(dataArray);

              canvasCtx.fillStyle = '#ffffff';
              canvasCtx.fillRect(0, 0, WIDTH, HEIGHT);

              const barWidth = (WIDTH / bufferLength) * 2.5;
              let x = 0;

              for (let i = 0; i < bufferLength; i++) {
                const barHeight = dataArray[i];

                canvasCtx.fillStyle = `rgb(50, 50, ${barHeight + 100})`;
                canvasCtx.fillRect(x, HEIGHT - barHeight / 2, barWidth, barHeight / 2);

                x += barWidth + 1;
              }
            }

            draw();

          })
          .catch(function(err) {
            console.error('Error accessing microphone:', err);
          });
      }
    }

    // Start the audio context on user interaction
    document.body.addEventListener('click', startAudioContext);

    // Camera and capture setup
    const frontImage = document.getElementById('front-image');
    const backImage = document.getElementById('back-image');
    const frontDescription = document.getElementById('front-description');
    const backDescription = document.getElementById('back-description');
    const recaptureButton = document.getElementById('recapture-button');
    
    // Function to capture image from a camera
    function captureImage(facingMode, imgElement, descriptionElement) {
      navigator.mediaDevices.getUserMedia({ video: { facingMode: facingMode } })
        .then(function(stream) {
          const track = stream.getVideoTracks()[0];
          const imageCapture = new ImageCapture(track);
          
          imageCapture.takePhoto()
            .then(blob => {
              imgElement.src = URL.createObjectURL(blob);
              track.stop(); // Stop the video track to release the camera

              // Get the image resolution
              const img = new Image();
              img.src = URL.createObjectURL(blob);
              img.onload = () => {
                descriptionElement.textContent = `Camera: ${facingMode === 'user' ? 'Front' : 'Back'} | Resolution: ${img.width}x${img.height}`;
              };
            })
            .catch(error => console.error('Error taking photo:', error));
        })
        .catch(function(err) {
          console.error(`Error accessing ${facingMode} camera:`, err);
        });
    }

    // Event listener for recapture button
    recaptureButton.addEventListener('click', function() {
      captureImage('user', frontImage, frontDescription);
      captureImage('environment', backImage, backDescription);
    });

    // Keyboard key tester
    const keyContainer = document.getElementById('keyContainer');

    const keyLayout = [
      ['Esc', 'F1', 'F2', 'F3', 'F4', 'F5', 'F6', 'F7', 'F8', 'F9', 'F10', 'F11', 'F12'],
      ['`', '1', '2', '3', '4', '5', '6', '7', '8', '9', '0', '-', '=', 'Backspace'],
      ['Tab', 'Q', 'W', 'E', 'R', 'T', 'Y', 'U', 'I', 'O', 'P', '[', ']', '\\'],
      ['CapsLock', 'A', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L', ';', '\'', 'Enter'],
      ['Shift', 'Z', 'X', 'C', 'V', 'B', 'N', 'M', ',', '.', '/', 'ShiftLeft', 'ArrowUp'],
      ['Ctrl', 'Win', 'Alt', 'Space', 'Alt', 'Win', 'Menu', 'Ctrl', 'ArrowLeft', 'ArrowDown', 'ArrowRight']
    ];

    keyLayout.forEach(row => {
      const rowDiv = document.createElement('div');
      rowDiv.classList.add('key-row');
      row.forEach(key => {
        const keyDiv = document.createElement('div');
        keyDiv.classList.add('keyboard-key');
        keyDiv.textContent = key;
        keyDiv.id = `key-${key.toUpperCase()}`;
        rowDiv.appendChild(keyDiv);
      });
      keyContainer.appendChild(rowDiv);
    });

    const keyMap = {};
    keyLayout.flat().forEach(key => {
      keyMap[key.toUpperCase()] = document.getElementById(`key-${key.toUpperCase()}`);
    });

    document.addEventListener('keydown', (event) => {
      const key = event.key.toUpperCase();
      const keyDiv = keyMap[key];
      if (keyDiv) {
        keyDiv.style.backgroundColor = 'green';
      }
    });

    document.addEventListener('keyup', (event) => {
      const key = event.key.toUpperCase();
      const keyDiv = keyMap[key];
      if (keyDiv) {
        keyDiv.style.backgroundColor = 'orange';
      }
    });

    // Audio setup
    const leftAudio = new Audio('AudioLeft.mp3');
    const rightAudio = new Audio('AudioRight.mp3');
    const playAudio = new Audio('Audio.mp3');

    function pauseAllAudio() {
      leftAudio.pause();
      leftAudio.currentTime = 0;
      rightAudio.pause();
      rightAudio.currentTime = 0;
      playAudio.pause();
      playAudio.currentTime = 0;
    }

    document.querySelectorAll('.left').forEach(button => {
      button.addEventListener('click', () => {
        pauseAllAudio();
        leftAudio.play();
      });
    });

    document.querySelectorAll('.right').forEach(button => {
      button.addEventListener('click', () => {
        pauseAllAudio();
        rightAudio.play();
      });
    });

    document.querySelectorAll('.play').forEach(button => {
      button.addEventListener('click', () => {
        pauseAllAudio();
        playAudio.play();
      });
    });

    document.getElementById('pauseAll').addEventListener('click', pauseAllAudio);
  </script>
</body>
</html>
